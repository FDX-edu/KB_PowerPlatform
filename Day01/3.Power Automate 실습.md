# 3. Power Automate 실습

네이버 API를 활용하여 특정 키워드의 뉴스 기사를 수집하고 요약하여 Teams 메시지로 전달하는 자동화를 만들어 봅시다.


## 네이버 API 설정

네이버 API를 호출하기 위해선 [네이버 개발자 센터](https://developers.naver.com/)에 등록이 필요합니다.  
애플리케이션을 생성하면 Client id와 Client Secret을 발급받을 수 있습니다.  


## Power Automate

### ① 흐름 생성

<img width="800" src="https://github.com/user-attachments/assets/4be085b7-48aa-43c6-bcbd-9ca5e8673de4" />

[Power Automate](make.powerautomate.com)에 접속합니다.
</br></br>

<img width="600" src="https://github.com/user-attachments/assets/ae183912-8f2f-46a2-8368-13633172ec5a" />
  
메인 페이지에서 **만들기** 탭으로 이동, **인스턴트 클라우드 흐름**을 선택합니다. 흐름을 생성할 수 있는 팝업 창이 표시됩니다.  
임의의 이름을 입력하고, 트리거 방법은 **'수동으로 흐름 트리거'** 를 선택합니다.  
</br></br>

<img width="400" src="https://github.com/user-attachments/assets/6132561a-f90d-40be-b353-934bc45d6a96" />
  
흐름 생성 완료 시 디자이너에 자동으로 **수동으로 흐름 트리거**가 추가됩니다.  
</br></br>

### ② HTTP 요청

<img width="600" src="https://github.com/user-attachments/assets/b37d6789-cfc8-4bea-90d8-624b3c877d0a" />

수동으로 흐름 트리거 아래의 **+** 를 클릭하고 HTTP를 검색하여, **HTTP**를 추가합니다.
</br></br>

<img width="600" src="https://github.com/user-attachments/assets/e81f5083-3f19-4710-b795-3bc9f76a66f3" />

| 항목                  | 값                                       | 설명       |
| --------------------- | ---------------------------------------- | ---------- |
| URI                   | https://openapi.naver.com/v1/search/news |            |
| Method                | GET                                      |            |
| X-Naver-Client-Id     |  ||
| X-Naver-Client-Secret |  ||
| query                 | 주식                                      | 검색 키워드 |
| display               | 10                                       | 검색할 개수 |
| start                 | 1                                        | 시작할 번호 |
| sort                  | date                                     | 정렬 순서   |

**입력할 값들(URI, Method, Headers, Queries 등)** 에 대해서는 네이버 개발자 센터의 [공식 문서](https://developers.naver.com/docs/serviceapi/search/news/news.md)를 참고합니다.  

</br></br>

<img width="600" src="https://github.com/user-attachments/assets/947db2df-b0ab-43da-bf9f-18b4ad3679f4" />

HTTP 요청에 대한 응답은 json 형태의 데이터로, 위 이미지와 같은 형태로 전달됩니다.
</br></br>

### ③ 데이터 추출

<img width="600" src="https://github.com/user-attachments/assets/5789f61d-5f05-4d81-ac67-ec79e0e948c2" />

**변수 초기화**를 추가하여 배열을 생성합니다. 이 배열은 API 응답의 **'기사제목 - 기사요약내용'** 형식으로 데이터를 저장할 배열입니다.
이제 10개의 뉴스 기사에 대해, HTTP 응답의 뉴스 데이터들을 추출하여 배열에 저장하도록 하겠습니다.
</br></br>

<img width="600" src="https://github.com/user-attachments/assets/76cbea46-9b04-4923-91c9-7286341df4ca" />

```
body('HTTP')['items']
```

**반복 적용**을 추가하고, 그 **매개 변수**에 HTTP 커넥터의 출력 중 items 항목을 넣어, 뉴스 기사를 순회할 수 있도록 합니다.
</br></br>


<img width="600" src="https://github.com/user-attachments/assets/01083fea-2f7a-4179-bc47-a59e5160877f" />

```
concat(items('반복_적용')['title'], ' - ', items('반복_적용')['description'])
```

**반복 적용**의 내부에 **배열 변수에 추가**를 추가하여 위와 같이 입력합니다.
</br></br>


<img width="600" src="https://github.com/user-attachments/assets/a1879156-7259-420f-a86c-6dc0c7b7cbb0" />

**조인**을 추가하여 배열의 모든 데이터를 하나로 만듭니다. **'다음으로 조인'** 옵션에는 줄바꿈(엔터)을 추가합니다.  
</br></br>


### ③ AI Builder 사용

<img width="400" src="https://github.com/user-attachments/assets/a15a1e67-1aa5-4673-a579-c16234737ac8" />

Power Automate 메인 화면에서 **프롬프트** 탭으로 이동하고, **프롬프트 직접 만들기**를 선택합니다.
</br></br>


<img width="600" src="https://github.com/user-attachments/assets/26c46df7-186d-46ec-943c-17dd2d7285c9" />


**지침**에 '/'를 입력하여 **텍스트 콘텐츠**를 추가하고, 임의의 이름을 입력합니다.  
텍스트 콘텐츠의 샘플 내용에는 테스트 도중 확인 가능한 **조인의 출력**을 입력합니다.  
</br></br>


<img width="600" src="https://github.com/user-attachments/assets/acd82e57-f68e-4a76-923a-5fa9a0fdb3cf" />

```
아래는 여러 뉴스 기사들의 제목과 내용입니다.
전체 내용을 요약하고, 핵심 내용을 기반으로 의미 있는 분석 또는 시사점을 한 문단으로 제시하세요
```

위와 같은 지침을 입력하고 저장합니다.
</br></br>

<img width="600" src="https://github.com/user-attachments/assets/210376b6-fb97-4d6d-8ca8-1922ecbd744e" />

**프롬프트 실행**을 추가하여 생성한 AI Builder를 호출합니다.
</br></br>


### ④ Teams 호출

<img width="600" src="https://github.com/user-attachments/assets/e3669981-c4c5-4479-b8c2-060de4e45875" />

**채팅 또는 채널에서 메시지 게시**를 추가하여 위와 같이 설정합니다.
</br></br>


<img width="400" src="https://github.com/user-attachments/assets/db9a8009-79ce-4346-b1e1-6317c3cd7871" />

저장 후 Teams에서 테스트 결과를 확인합니다.
</br></br>


### ※ 기타

<img width="600" src="https://github.com/user-attachments/assets/f956c34d-564a-4078-9da0-739bc72b1439" />

프롬프트 실행을 사용한 경우, AI 콘텐츠의 품질과 윤리 표준 확인을 위하여 콘텐츠 승인 작업을 추가할 것을 제안합니다.  
</br></br>

<img width="600" src="https://github.com/user-attachments/assets/f79838bd-d4c3-4c9c-960f-9ebe48c3e47b" />

**승인 시작 및 대기**는 텍스트를 특정 사용자에게 승인을 요청하고, 승인 결과가 확정될 때까지 대기합니다.  
여기서 AI로 생성된 텍스트를 담당자에게 승인을 요청하고, 담당자가 처리할 때까지 기다리게 됩니다.  
</br></br>

<img width="600" src="https://github.com/user-attachments/assets/fd00c781-4801-4e66-a7f8-af52f1f8032c" />

**조건**을 추가하여, 승인 시작 및 대기의 결과가 승인되었는지를 체크합니다. 승인되면 결과에 Approve가 저장되고, 조건에 따라 체크하게 됩니다.  
</br></br>

<img width="600" src="https://github.com/user-attachments/assets/a2ece5e9-ade7-4fec-9278-0364b74315f1" />

채팅 또는 채널에서 메시지 게시를 조건의 True 블럭 내부로 이동시킵니다.
</br></br>


<img width="800" src="https://github.com/user-attachments/assets/1341b9e8-63ef-48c2-ba5b-2cd2a7538aa5" />

실행 시 PowerAutomate의 승인 탭이나, Teams에서 승인 요청을 확인할 수 있습니다.  
승인할 텍스트를 미리 확인해 보고, 승인할지 거부할지 결정할 수 있습니다.



